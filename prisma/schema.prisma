generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id     String  @id @default(cuid())
  email  String  @unique
  senha  String
  status String  @default("ATIVO")
  perfil String  @default("USUARIO")
  nome   String?

  criadoEm     DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @updatedAt @map("atualizado_em")

  @@map("usuario")
}

model Produto {
  id     String @id @default(cuid())
  nome   String @unique
  status String @default("ATIVO")

  estoque                 ProdutoEstoque?
  produtoCesta            ProdutoCesta[]
  doacoesRecebidas        ItemRecebimento[]
  distribuicaoEmergencial ItemDistribuicaoEmergencial[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("produto")
}

model ProdutoEstoque {
  id         String @id @default(cuid())
  produtoId  String @unique @map("produto_id")
  quantidade Int    @default(0)

  produto       Produto                      @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  movimentacoes ProdutoMovimentacaoEstoque[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("produto_estoque")
}

model ProdutoMovimentacaoEstoque {
  id               String  @id @default(cuid())
  estoqueProdutoId String  @map("estoque_produto_id")
  quantidade       Int     @default(0)
  tipo             String // ENTRADA ou SAIDA
  motivo           String?

  produtoEstoque ProdutoEstoque @relation(fields: [estoqueProdutoId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("produto_movimentacao_estoque")
}

model RecebimentoDoacao {
  id         String   @id @default(cuid())
  dataDoacao DateTime @default(now()) @map("data_doacao")
  origem     String // ex: MISSA_DOMINGO, MISSA_SABADO, CAMPANHA, PONTUAL
  observacao String?

  itens ItemRecebimento[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("recebimento_doacao")
}

model ItemRecebimento {
  id         String @id @default(cuid())
  doacaoId   String @map("doacao_id")
  produtoId  String @map("produto_id")
  quantidade Int

  recebimento RecebimentoDoacao @relation(fields: [doacaoId], references: [id], onDelete: Cascade)
  produto     Produto           @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("item_recebimento")
}

model DistribuicaoEmergencial {
  id               String   @id @default(cuid())
  dataDistribuicao DateTime @default(now()) @map("data_distribuicao")
  beneficiario     String?
  motivo           String?

  itens ItemDistribuicaoEmergencial[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("distribuicao_emergencial")
}

model ItemDistribuicaoEmergencial {
  id                        String @id @default(cuid())
  distribuicaoEmergencialId String @map("distribuicao_emergencial_id")
  produtoId                 String @map("produto_id")
  quantidade                Int

  distribuicao DistribuicaoEmergencial @relation(fields: [distribuicaoEmergencialId], references: [id], onDelete: Cascade)
  produto      Produto                 @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("item_distribuicao_emergencial")
}

model TipoCesta {
  id        String  @id @default(cuid())
  nome      String  @unique
  status    String  @default("ATIVO")
  descricao String?

  produtos        ProdutoCesta[]
  beneficiarios   Beneficiario[]
  historicoSaidas HistoricoDistribuicao[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("tipo_cesta")
}

model ProdutoCesta {
  id          String @id @default(cuid())
  produtoId   String @map("produto_id")
  tipoCestaId String @map("tipo_cesta_id")
  quantidade  Int

  produto   Produto   @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  tipoCesta TipoCesta @relation(fields: [tipoCestaId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("produto_cesta")
}

model Beneficiario {
  id                   String    @id @default(cuid())
  status               String    @default("ATIVO")
  nome                 String
  cpf                  String?   @unique
  rg                   String?   @unique
  sexo                 String
  dataNascimento       DateTime? @map("data_nascimento")
  telefone             String?
  estadoCivil          String?   @map("estado_civil")
  profissao            String?
  rendaMensal          String?
  pessoaComDeficiencia Boolean   @default(false) @map("pessoa_com_deficiencia")
  tipoCestaId          String?   @map("tipo_cesta_id")
  efetivadoEm          DateTime? @map("efetivado_em")

  tipoCesta              TipoCesta?                     @relation(fields: [tipoCestaId], references: [id], onDelete: SetNull)
  endereco               EnderecoBeneficiario?
  beneficiosSociais      BeneficiosSociaisBeneficiario?
  saude                  SaudeBeneficiario?
  interesses             InteressesBeneficiario?
  dependentes            DependenteBeneficiario[]
  historicoRecebimentos  HistoricoDistribuicao[]
  historicoDesligamentos DesligamentoBeneficiario[]

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("beneficiario")
}

model EnderecoBeneficiario {
  id              String  @id @default(cuid())
  beneficiarioId  String  @unique @map("beneficiario_id")
  rua             String?
  numero          String?
  bairro          String?
  cidade          String?
  cep             String?
  complemento     String?
  pontoReferencia String? @map("ponto_referencia")
  numeroComodos   Int     @map("numero_comodos")

  proprio        Boolean @default(false)
  financiado     Boolean @default(false)
  alugado        Boolean @default(false)
  cedido         Boolean @default(false)
  heranca        Boolean @default(false)
  programaSocial Boolean @default(false)
  ocupacao       Boolean @default(false)

  banheiro        Boolean @default(true)
  aguaEncanada    Boolean @default(true) @map("agua_encanada")
  energiaEletrica Boolean @default(true) @map("energia_eletrica")
  esgoto          Boolean @default(true)

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("endereco_beneficiario")
}

model BeneficiosSociaisBeneficiario {
  id                          String  @id @default(cuid())
  beneficiarioId              String  @unique() @map("beneficiario_id")
  bolsaFamilia                Boolean @default(false) @map("bolsa_familia")
  cadUnico                    Boolean @default(false) @map("cad_unico")
  loas                        Boolean @default(false)
  carteiraIdoso               Boolean @default(false) @map("carteira_idoso")
  cartaoFamiliaCarioca        Boolean @default(false) @map("cartao_familia_carioca")
  minhaCasaMinhaVida          Boolean @default(false) @map("minha_casa_minha_vida")
  paif                        Boolean @default(false)
  pronatec                    Boolean @default(false)
  aposentadoria               Boolean @default(false)
  isencaoConcursoPublico      Boolean @default(false) @map("isencao_concurso_publico")
  cadastroParaEmprego         Boolean @default(false) @map("cadastro_para_emprego")
  tarifaSocialEnergiaEletrica Boolean @default(false) @map("tarifa_social_energia_eletrica")
  outrosBeneficios            String? @map("outros_beneficios")
  observacao                  String?

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("beneficios_sociais_beneficiario")
}

model SaudeBeneficiario {
  id                   String   @id @default(cuid())
  beneficiarioId       String   @unique() @map("beneficiario_id")
  cartaoSUS            Boolean?
  numeroCartaoSUS      String?
  clinicaFamilia       String?
  postoSaude           String?
  tratamentoHospitalar Boolean?
  hospital             String?
  tratamentoSaude      String?
  medicamentos         String?
  observacao           String?

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("saude_beneficiario")
}

model InteressesBeneficiario {
  id                  String  @id @default(cuid())
  beneficiarioId      String  @unique() @map("beneficiario_id")
  // Palestras
  programasSociais    Boolean @default(false) @map("programas_sociais")
  violenciaDomestica  Boolean @default(false) @map("violencia_domestica")
  dependenciaQuimica  Boolean @default(false) @map("dependencia_quimica")
  meioAmbiente        Boolean @default(false) @map("meio_ambiente")
  documentacaoPessoal Boolean @default(false) @map("documentacao_pessoal")
  saudeGeral          Boolean @default(false) @map("saude_geral")
  empreendedorismo    Boolean @default(false) @map("empreendedorismo")
  sustentabilidade    Boolean @default(false) @map("sustentabilidade")
  // Cursos
  pinturaEmTecido     Boolean @default(false) @map("pintura_em_tecido")
  bijuteria           Boolean @default(false)
  cestaria            Boolean @default(false)
  costura             Boolean @default(false)
  bordado             Boolean @default(false)
  croche              Boolean @default(false)
  trico               Boolean @default(false)
  teatro              Boolean @default(false)
  reciclagem          Boolean @default(false)
  informatica         Boolean @default(false)
  cursos              Boolean @default(false)
  alfabetizacao       Boolean @default(false)

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("interesses_beneficiario")
}

model DependenteBeneficiario {
  id                 String    @id @default(cuid())
  beneficiarioId     String    @map("beneficiario_id")
  nome               String
  cpf                String?
  rg                 String?
  certidaoNascimento String?   @map("certidao_nascimento")
  parentesco         String
  escolaridade       String?
  sexo               String
  dataNascimento     DateTime? @map("data_nascimento")
  rendaMensal        String?
  trabalho           String?
  observacao         String?

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("dependente_beneficiario")
}

model DesligamentoBeneficiario {
  id               String    @id @default(cuid())
  beneficiarioId   String    @map("beneficiario_id")
  motivo           String?
  dataDesligamento DateTime? @map("data_desligamento")

  beneficiario Beneficiario @relation(fields: [beneficiarioId], references: [id], onDelete: Cascade)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("desligamento_beneficiario")
}

model HistoricoDistribuicao {
  id             String  @id @default(cuid())
  tipoCestaId    String? @map("tipo_cesta_id")
  beneficiarioId String? @map("beneficiario_id")
  nomeCesta      String

  tipoCesta    TipoCesta?    @relation(fields: [tipoCestaId], references: [id], onDelete: SetNull)
  beneficiario Beneficiario? @relation(fields: [beneficiarioId], references: [id], onDelete: SetNull)

  criadoEm     DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime? @updatedAt @map("atualizado_em")

  @@map("historico_distribuicao")
}

model ControleTentativaAcesso {
  id     String  @id @default(cuid())
  sessao String
  ip     String?
  email  String?

  criadoEm DateTime @default(now()) @map("criado_em")

  @@map("controle_tentativa_acesso")
}
